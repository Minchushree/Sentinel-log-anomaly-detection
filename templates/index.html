<!DOCTYPE html>
<html>
<head>
    <title>Sentinel Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .header-nav {
            text-align: center;
            margin-bottom: 20px;
        }
        .header-nav a {
            display: inline-block;
            margin: 0 10px;
            padding: 10px 20px;
            background-color: #2196F3;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
        }
        .header-nav a:hover {
            background-color: #1976D2;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .metric-card {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        .metric-card h3 {
            margin: 0;
            color: #666;
            font-size: 14px;
        }
        .metric-value {
            font-size: 32px;
            font-weight: bold;
            color: #2196F3;
            margin: 10px 0;
        }
        .metric-anomaly .metric-value {
            color: #f44336;
        }
        .metric-rate .metric-value {
            color: #ff9800;
        }
        .charts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }
        .chart-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .chart-container h3 {
            margin-top: 0;
            color: #333;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>üõ°Ô∏è Sentinel Live Dashboard</h1>
    
    <div class="header-nav">
        <a href="/">üìä Main Dashboard</a>
        <a href="/advanced">üîç Advanced Analytics</a>
    </div>
    
    <div class="metrics">
        <div class="metric-card">
            <h3>Total Logs Processed</h3>
            <div class="metric-value" id="totalLogs">0</div>
        </div>
        <div class="metric-card metric-anomaly">
            <h3>Anomalies Detected</h3>
            <div class="metric-value" id="anomalyCount">0</div>
        </div>
        <div class="metric-card metric-rate">
            <h3>Anomaly Rate</h3>
            <div class="metric-value" id="anomalyRate">0%</div>
        </div>
        <div class="metric-card">
            <h3>Normal Logs</h3>
            <div class="metric-value" id="normalCount">0</div>
        </div>
    </div>

    <div class="charts">
        <div class="chart-container">
            <h3>Logs Over Time</h3>
            <canvas id="logChart"></canvas>
        </div>
        <div class="chart-container">
            <h3>Distribution: Normal vs Anomalous</h3>
            <canvas id="anomalyChart"></canvas>
        </div>
        <div class="chart-container">
            <h3>Anomaly Trend</h3>
            <canvas id="trendChart"></canvas>
        </div>
        <div class="chart-container">
            <h3>Summary Results</h3>
            <canvas id="summaryChart"></canvas>
        </div>
    </div>
</div>

<script>
// Initialize all charts
const logCtx = document.getElementById("logChart").getContext("2d");
const anomalyCtx = document.getElementById("anomalyChart").getContext("2d");
const trendCtx = document.getElementById("trendChart").getContext("2d");
const summaryCtx = document.getElementById("summaryChart").getContext("2d");

const logChart = new Chart(logCtx, {
    type: "line",
    data: {
        labels: [],
        datasets: [{
            label: "Logs Processed",
            data: [],
            borderColor: "#2196F3",
            backgroundColor: "rgba(33, 150, 243, 0.1)",
            borderWidth: 2,
            tension: 0.4
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { display: true }
        },
        scales: {
            y: { beginAtZero: true }
        }
    }
});

const anomalyChart = new Chart(anomalyCtx, {
    type: "bar",
    data: {
        labels: ["Normal", "Anomalous"],
        datasets: [{
            label: "Count",
            data: [0, 0],
            backgroundColor: ["#4CAF50", "#f44336"],
            borderColor: ["#45a049", "#da190b"],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { display: true }
        },
        scales: {
            y: { beginAtZero: true }
        }
    }
});

const trendChart = new Chart(trendCtx, {
    type: "line",
    data: {
        labels: [],
        datasets: [{
            label: "Anomalies Trend",
            data: [],
            borderColor: "#f44336",
            backgroundColor: "rgba(244, 67, 54, 0.1)",
            borderWidth: 2,
            tension: 0.4
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { display: true }
        },
        scales: {
            y: { beginAtZero: true }
        }
    }
});

const summaryChart = new Chart(summaryCtx, {
    type: "bar",
    data: {
        labels: ["Total Logs", "Normal Logs", "Anomalies"],
        datasets: [{
            label: "Results Summary",
            data: [0, 0, 0],
            backgroundColor: ["#2196F3", "#4CAF50", "#f44336"],
            borderColor: ["#1976D2", "#45a049", "#da190b"],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { display: true }
        },
        scales: {
            y: { beginAtZero: true }
        }
    }
});

function fetchMetrics() {
    fetch("/metrics")
        .then(res => res.json())
        .then(data => {
            const totalLogs = data.total_logs;
            const anomalyCount = data.anomaly_count;
            const normalCount = totalLogs - anomalyCount;
            const anomalyRate = totalLogs > 0 ? ((anomalyCount / totalLogs) * 100).toFixed(2) : 0;

            // Update metrics cards
            document.getElementById("totalLogs").innerText = totalLogs;
            document.getElementById("anomalyCount").innerText = anomalyCount;
            document.getElementById("normalCount").innerText = normalCount;
            document.getElementById("anomalyRate").innerText = anomalyRate + "%";

            // Update line chart - Logs Over Time
            logChart.data.labels = data.log_timeline.map((_, i) => i + 1);
            logChart.data.datasets[0].data = data.log_timeline;
            logChart.update();

            // Update bar chart - Distribution
            anomalyChart.data.datasets[0].data = [normalCount, anomalyCount];
            anomalyChart.update();

            // Update trend chart - Anomaly progression
            trendChart.data.labels = data.anomaly_timeline.map((_, i) => i + 1);
            trendChart.data.datasets[0].data = data.anomaly_timeline;
            trendChart.update();

            // Update summary bar chart - Final results
            summaryChart.data.datasets[0].data = [totalLogs, normalCount, anomalyCount];
            summaryChart.update();
        })
        .catch(err => console.error("Error fetching metrics:", err));
}

// Initial fetch and refresh every 3 seconds
fetchMetrics();
setInterval(fetchMetrics, 3000);
</script>

</body>
</html>
